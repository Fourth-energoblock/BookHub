#import "../data.typ": data

= ТРЕБОВАНИЯ К ПРОГРАММЕ
== Требования к функциональным характеристикам

=== Сценарии использования (Workflow)

Программа "#data.project_name" предполагает следующие основные сценарии использования:

*Сценарий 1: Первое знакомство с платформой*

+ Пользователь открывает веб-приложение или устанавливает Android-приложение
+ Пользователь нажимает кнопку "Регистрация"
+ Пользователь вводит Email-адрес и пароль (не менее 8 символов)
+ Система отправляет письмо с подтверждением на указанный Email
+ Пользователь переходит по ссылке из письма
+ Система подтверждает регистрацию и перенаправляет на страницу входа
+ Пользователь вводит учетные данные и входит в систему

*Сценарий 2: Поиск и чтение книги*

+ Авторизованный пользователь находится на главной странице каталога
+ Пользователь вводит название книги или имя автора в поле поиска
+ Система отображает список результатов (не более 20 на странице)
+ Пользователь нажимает на обложку выбранной книги
+ Система отображает карточку книги с метаданными
+ Пользователь нажимает кнопку "Читать"
+ Система открывает книгу в модуле чтения (ридере)
+ Пользователь листает страницы кнопками "Вперед/Назад" или клавишами стрелок
+ При закрытии книги система автоматически сохраняет позицию чтения

*Сценарий 3: Создание аннотации*

+ Пользователь читает книгу в ридере
+ Пользователь выделяет фрагмент текста мышью (веб) или касанием (Android)
+ Система отображает контекстное меню с опцией "Создать аннотацию"
+ Пользователь нажимает на опцию "Создать аннотацию"
+ Система открывает форму создания аннотации
+ Пользователь вводит текст комментария (от 1 до 1000 символов)
+ Пользователь выбирает уровень доступа: приватный, публичный или по ссылке
+ Пользователь нажимает кнопку "Сохранить"
+ Система сохраняет аннотацию и отображает её в тексте книги

*Сценарий 4: Создание коллекции*

+ Авторизованный пользователь открывает раздел "Мои коллекции"
+ Пользователь нажимает кнопку "Создать коллекцию"
+ Система открывает форму создания коллекции
+ Пользователь вводит название коллекции (от 1 до 100 символов)
+ Пользователь опционально вводит описание (до 500 символов)
+ Пользователь нажимает кнопку "Создать"
+ Система создает коллекцию и отображает её в списке
+ Пользователь переходит в каталог, выбирает книгу
+ Пользователь нажимает кнопку "Добавить в коллекцию"
+ Система отображает список коллекций пользователя
+ Пользователь выбирает коллекцию
+ Система добавляет книгу в выбранную коллекцию

*Сценарий 5: Офлайн-чтение (Android)*

+ Пользователь открывает Android-приложение при наличии интернета
+ Пользователь находит книгу в каталоге
+ Пользователь нажимает кнопку "Скачать для офлайн"
+ Система загружает книгу в локальное хранилище устройства
+ Система отображает индикатор прогресса загрузки (процент)
+ После завершения загрузки книга отмечается значком "Доступна офлайн"
+ Пользователь отключает интернет-соединение
+ Пользователь открывает скачанную книгу и читает её
+ Пользователь создает аннотацию (сохраняется локально)
+ При восстановлении интернет-соединения система автоматически синхронизирует данные с сервером

=== Модуль регистрации и авторизации

Модуль регистрации и авторизации должен обеспечивать следующие функции:

+ *Регистрация пользователя:* система должна позволять регистрацию нового пользователя с указанием Email-адреса и пароля. Email-адрес должен соответствовать формату RFC 5322 (содержать символ "@" и доменную часть). Пароль должен содержать не менее 8 символов, включая как минимум одну букву и одну цифру. После регистрации на указанный Email-адрес должно отправляться письмо с ссылкой для подтверждения. Пользователь не может войти в систему до перехода по ссылке подтверждения.

+ *Авторизация пользователя:* система должна обеспечивать авторизацию зарегистрированных пользователей по Email-адресу и паролю. При успешной авторизации система должна генерировать JWT (JSON Web Token) токен. Срок действия токена должен составлять 24 часа. При вводе неверных учетных данных система должна выводить сообщение "Неверный Email или пароль" без указания, какое именно поле было введено неверно.

+ *Выход из системы:* пользователь должен иметь возможность выйти из системы. При выходе токен должен быть аннулирован на клиенте.

+ *Хранение паролей:* система должна хранить пароли пользователей в виде хеша с использованием алгоритма bcrypt (cost factor не менее 10). Исходные пароли не должны сохраняться в базе данных.

=== Модуль каталога книг

Модуль каталога книг должен обеспечивать следующие функции:

+ *Отображение списка книг:* система должна отображать список доступных книг с пагинацией. На одной странице должно отображаться не более 20 книг. Для каждой книги должны отображаться: обложка (изображение размером не менее 150x200 пикселей), название, автор.

+ *Поиск книг по названию:* система должна предоставлять поле ввода для поиска книг. При вводе текста длиной не менее 2 символов система должна выполнять поиск. Поиск должен находить книги, название которых содержит введенную подстроку (регистронезависимо). Если совпадений не найдено, система должна выводить сообщение "Книги не найдены".

+ *Поиск книг по автору:* система должна предоставлять возможность поиска книг по имени автора. Поиск должен находить книги, автор которых содержит введенную подстроку.

+ *Отображение метаданных книги:* при нажатии на книгу система должна отображать карточку с информацией: обложка, название, автор, количество страниц (если доступно), описание (до 500 символов), количество публичных аннотаций.

+ *Интеграция с Project Gutenberg:* система должна получать книги из библиотеки Project Gutenberg через их публичный API.

+ *Интеграция с Google Books API:* система должна использовать Google Books API для получения метаданных книг: обложки, описания.

+ *Интеграция с LitRes:* система должна обеспечивать доступ к публичным и бесплатным коллекциям LitRes.

=== Модуль чтения (Ридер)

Модуль чтения должен обеспечивать следующие функции:

+ *Отображение текста книги:* система должна отображать текст книги с разбивкой на страницы. Текст должен занимать область экрана с отступами не менее 20 пикселей от краев. Должно поддерживаться отображение форматирования: курсив, полужирный текст.

+ *Навигация по книге:* пользователь должен иметь возможность перемещаться по страницам книги:
  - Веб: кнопками на экране или клавишами "стрелка влево" / "стрелка вправо"
  - Android: касанием левой/правой части экрана или свайпом
  Система должна отображать номер текущей страницы и общее количество страниц в формате "X / Y".

+ *Настройка размера шрифта:* пользователь должен иметь возможность выбрать размер шрифта из предустановленных значений: 14, 16, 18, 20, 22 пунктов. Выбранный размер должен сохраняться в профиле пользователя.

+ *Настройка цветовой темы:* система должна предоставлять две темы:
  - Светлая: темно-серый текст на белом фоне
  - Темная: светло-серый текст на темном фоне
  Выбранная тема должна сохраняться в профиле пользователя.

+ *Сохранение позиции чтения:* система должна автоматически сохранять номер текущей страницы при закрытии книги или переходе на другую страницу приложения. При повторном открытии книги система должна открывать её на сохраненной странице.

+ *Выделение текста для аннотаций:* пользователь должен иметь возможность выделить фрагмент текста. Длина выделенного фрагмента должна быть от 1 до 500 символов. После выделения должно появляться меню с опцией "Создать аннотацию".

+ *Офлайн-режим (Android):* Android-приложение должно позволять читать предварительно загруженные книги без интернет-соединения. Загруженные книги должны храниться в локальной базе данных устройства.

=== Модуль аннотаций

Модуль аннотаций должен обеспечивать следующие функции:

+ *Создание аннотации:* пользователь должен иметь возможность создать текстовую аннотацию к выделенному фрагменту. Аннотация должна содержать:
  - Текст комментария: от 1 до 1000 символов
  - Привязку к фрагменту: идентификатор книги, номер страницы, позиции начала и конца
  - Дату создания (устанавливается автоматически)
  - Уровень доступа (выбирается пользователем)

+ *Уровни доступа к аннотациям:* система должна поддерживать три уровня:
  - *Приватный:* аннотация видна только автору
  - *Публичный:* аннотация видна всем авторизованным пользователям
  - *По ссылке:* аннотация доступна по уникальной ссылке формата "/annotation/{id}"
  По умолчанию должен быть установлен приватный уровень.

+ *Редактирование аннотации:* пользователь должен иметь возможность изменить текст и уровень доступа своих аннотаций. При редактировании должна обновляться дата изменения.

+ *Удаление аннотации:* пользователь должен иметь возможность удалить свои аннотации. Перед удалением система должна запрашивать подтверждение с текстом "Удалить аннотацию?".

+ *Просмотр собственных аннотаций:* пользователь должен иметь доступ к списку своих аннотаций. Список должен отображаться с пагинацией (20 аннотаций на странице). Должна быть возможность перехода к книге при нажатии на аннотацию.

+ *Просмотр публичных аннотаций:* при чтении книги пользователь должен видеть маркеры публичных аннотаций других пользователей в тексте. При нажатии на маркер должна отображаться аннотация с именем автора и датой.

+ *Ограничения бесплатной версии:* пользователи бесплатной версии могут создать не более 100 приватных аннотаций. Публичные аннотации и аннотации по ссылке не ограничены. При достижении лимита система должна отображать сообщение "Достигнут лимит приватных аннотаций".

=== Модуль коллекций

Модуль коллекций должен обеспечивать следующие функции:

+ *Создание коллекции:* пользователь должен иметь возможность создать коллекцию с указанием:
  - Название: обязательное поле, от 1 до 100 символов
  - Описание: необязательное поле, до 500 символов

+ *Редактирование коллекции:* пользователь должен иметь возможность изменить название и описание своих коллекций.

+ *Удаление коллекции:* пользователь должен иметь возможность удалить коллекцию. При удалении книги в коллекции не удаляются из каталога. Перед удалением система должна запрашивать подтверждение.

+ *Добавление книги в коллекцию:* пользователь должен иметь возможность добавить книгу в одну или несколько своих коллекций.

+ *Удаление книги из коллекции:* пользователь должен иметь возможность убрать книгу из коллекции.

+ *Просмотр коллекций:* пользователь должен видеть список своих коллекций с названием, описанием и количеством книг.

+ *Просмотр содержимого коллекции:* при открытии коллекции должен отображаться список книг с обложками, названиями и авторами.

+ *Ограничения бесплатной версии:* пользователи бесплатной версии могут создать не более 10 коллекций. При достижении лимита система должна отображать сообщение "Достигнут лимит коллекций (10)".

=== Модуль синхронизации (Android)

Модуль синхронизации для Android-приложения должен обеспечивать следующие функции:

+ *Синхронизация данных:* приложение должно синхронизировать с сервером: аннотации, коллекции, позиции чтения, настройки профиля. Синхронизация должна выполняться:
  - Автоматически при запуске приложения (при наличии интернета)
  - Вручную по нажатию кнопки "Синхронизировать"

+ *Загрузка книг для офлайн-чтения:* пользователь должен иметь возможность скачать книгу на устройство. Во время загрузки должен отображаться прогресс в процентах. Загруженные книги должны храниться в локальной базе данных.

+ *Работа в офлайн-режиме:* без интернета пользователь должен иметь доступ к:
  - Чтению загруженных книг
  - Созданию и редактированию аннотаций (сохраняются локально)
  - Просмотру своих коллекций

+ *Синхронизация после офлайн:* при восстановлении интернет-соединения данные, созданные в офлайн-режиме, должны автоматически отправляться на сервер.

=== Требования к входным и выходным данным

*Входные данные:*

#figure(
  caption: [Требования к входным данным],
  table(
    columns: (4cm, 4cm, 6cm),
    align: (left, left, left),
    table.header([Поле], [Формат], [Ограничения]),
    [Email], [Строка], [Соответствует RFC 5322, до 254 символов],
    [Пароль], [Строка], [8-128 символов, минимум 1 буква и 1 цифра],
    [Название коллекции], [Строка], [1-100 символов, не пустое],
    [Описание коллекции], [Строка], [0-500 символов],
    [Текст аннотации], [Строка], [1-1000 символов],
    [Поисковый запрос], [Строка], [2-100 символов],
  ),
)

*Выходные данные:*

#figure(
  caption: [Требования к выходным данным],
  table(
    columns: (4cm, 10cm),
    align: (left, left),
    table.header([Данные], [Описание]),
    [Список книг], [Массив объектов: id, название, автор, обложка (URL)],
    [Карточка книги], [Объект: id, название, автор, обложка, описание, страниц, аннотаций],
    [Страница книги], [Текст страницы с форматированием HTML],
    [Аннотация], [Объект: id, текст, автор, дата, уровень доступа, позиция],
    [Коллекция], [Объект: id, название, описание, количество книг, список книг],
    [Сообщение об ошибке], [Строка с описанием ошибки, код ошибки HTTP],
  ),
)

=== Требования к временным характеристикам

Программа "#data.project_name" должна обеспечивать следующие временные характеристики на устройствах, соответствующих требованиям к техническим средствам:

#figure(
  caption: [Требования к временным характеристикам],
  table(
    columns: (6cm, 4cm, 4cm),
    align: (left, center, center),
    table.header([Операция], [Максимальное время], [Условия]),
    [Загрузка главной страницы], [3 секунды], [Скорость соединения 1 Мбит/с],
    [Отклик API на запрос], [200 миллисекунд], [95% запросов],
    [Открытие книги в ридере], [2 секунды], [Скорость соединения 1 Мбит/с],
    [Сохранение аннотации], [1 секунда], [Скорость соединения 1 Мбит/с],
    [Поиск книг по каталогу], [2 секунды], [Скорость соединения 1 Мбит/с],
    [Синхронизация данных Android], [5 секунд], [Wi-Fi соединение],
    [Загрузка страницы книги], [500 миллисекунд], [После открытия книги],
  ),
)

+ *Время отклика интерфейса:* время отклика на пользовательские действия (нажатие кнопок, переключение страниц) не должно превышать 200 миллисекунд.

+ *Время загрузки контента:* время загрузки страницы книги при наличии интернет-соединения не должно превышать 2 секунд.

+ *Время синхронизации:* синхронизация данных между Android-приложением и сервером при восстановлении интернет-соединения должна начинаться автоматически в течение 5 секунд.

== Требования к надежности

+ *Доступность системы:* доступность должна составлять не менее 99,9 процентов в месяц (не более 43 минут недоступности).

+ *Устойчивость к нагрузке:* система должна сохранять работоспособность при одновременной работе до 1000 пользователей.

+ *Резервное копирование:* база данных должна копироваться не реже одного раза в 24 часа. Резервные копии должны храниться не менее 30 дней.

+ *Валидация данных:* все входные данные должны проходить валидацию на сервере. При получении некорректных данных система должна возвращать HTTP-статус 400 и описание ошибки.

+ *Обработка ошибок:* при возникновении ошибок система должна:
  - Отображать пользователю сообщение с описанием проблемы
  - Логировать ошибку на сервере с временной меткой и stack trace

+ *Защита от атак:*
  - Все соединения должны использовать HTTPS
  - Пароли должны храниться в виде bcrypt-хешей
  - Запросы к API должны содержать JWT-токен в заголовке Authorization

== Условия эксплуатации

+ *Веб-приложение:* поддерживаются браузеры Chrome, Firefox, Safari последних двух версий. Минимальное разрешение экрана: 1280x720 пикселей. Требуется интернет-соединение.

+ *Android-приложение:* Android версии 8.0 и выше (API level 26+). Минимум 2 ГБ оперативной памяти. Минимум 100 МБ свободного места для приложения.

+ *Интернет-соединение:* для онлайн-функций требуется соединение со скоростью не менее 1 Мбит/с.

=== Требования к видам обслуживания

+ Программа не требует специального технического обслуживания со стороны конечных пользователей.
+ Обслуживание серверной инфраструктуры осуществляется командой разработчиков.
+ Обновления приложения должны устанавливаться автоматически (веб) или с минимальным участием пользователя (Android).

=== Требования к численности и квалификации персонала

+ *Численность:* требования к численности персонала не предъявляются. Программа предназначена для индивидуального использования.

+ *Квалификация пользователей:* специальной подготовки и квалификации не требуется. Пользователь должен обладать базовыми навыками работы с веб-браузером или мобильными приложениями Android.

+ *Квалификация администраторов:* для обслуживания серверной части требуются знания серверных технологий, баз данных и облачных платформ.

== Требования к составу и параметрам технических средств

=== Клиентская часть (веб-приложение)

+ Веб-браузер с поддержкой HTML5, CSS3, JavaScript ES6
+ Минимум 2 ГБ оперативной памяти
+ Разрешение экрана от 1280x720 пикселей
+ Интернет-соединение не менее 1 Мбит/с

=== Клиентская часть (Android-приложение)

+ Операционная система Android 8.0 и выше (API 26+)
+ Минимум 2 ГБ оперативной памяти
+ Минимум 100 МБ для установки, рекомендуется 500 МБ для офлайн-книг
+ Дисплей с разрешением от 720x1280 пикселей

== Требования к информационной и программной совместимости

=== Требования к исходным кодам и языкам программирования

+ Исходный код программы должен быть написан с использованием современных языков программирования, обеспечивающих кроссплатформенность и поддержку веб-приложений и мобильных приложений Android.
+ Конкретные требования к языкам программирования и технологиям определяются на этапе проектирования и описываются в Пояснительной Записке.
+ Исходный код должен следовать общепринятым стандартам кодирования и содержать комментарии.

=== Форматы обмена данными

+ Обмен данными между клиентом и сервером: JSON
+ Кодировка текста: UTF-8
+ Аутентификация: JWT (JSON Web Token)

=== Внешние интеграции

+ Project Gutenberg API: получение текстов книг
+ Google Books API: получение метаданных (обложки, описания)
+ LitRes API: доступ к публичным коллекциям

=== Требования к безопасности

+ Все HTTP-соединения должны использовать TLS 1.2 или выше
+ Пароли хранятся в виде bcrypt-хеша (cost factor 10)
+ JWT-токены имеют срок действия 24 часа
+ API-запросы без валидного токена возвращают HTTP 401

=== Требования к защите информации и программ

+ *Защита персональных данных:* программа должна обеспечивать защиту персональных данных пользователей в соответствии с требованиями Федерального закона № 152-ФЗ «О персональных данных». Персональные данные должны храниться в зашифрованном виде.

+ *Защита от несанкционированного доступа:* доступ к данным пользователя (аннотациям, коллекциям, позициям чтения) должен быть ограничен владельцем аккаунта. Приватные аннотации не должны быть доступны другим пользователям.

+ *Защита от атак:* программа должна обеспечивать защиту от распространенных видов атак:
  - SQL-инъекции: использование параметризованных запросов
  - XSS (межсайтовый скриптинг): экранирование пользовательского ввода
  - CSRF (подделка межсайтовых запросов): использование CSRF-токенов

+ *Аудит безопасности:* все операции авторизации и изменения данных должны логироваться с указанием времени, IP-адреса и user ID.

+ *Защита исходного кода:* исходный код должен храниться в приватном репозитории с ограниченным доступом для членов команды разработки.

== Требования к маркировке и упаковке

+ Веб-приложение должно содержать файл favicon.ico
+ Android-приложение должно иметь иконку размерами 48x48, 72x72, 96x96, 144x144, 192x192 пикселей
+ Версионирование: формат MAJOR.MINOR.PATCH (Semantic Versioning)
+ Электронный архив с программой должен содержать маркировку с указанием: наименование программы, версия, дата сборки, авторы (участники команды разработки)

== Требования к транспортированию и хранению

+ Веб-приложение должно быть развернуто на облачной платформе с поддержкой HTTPS
+ Backend должен быть развернут на облачном хостинге с гарантированной доступностью
+ База данных должна располагаться на облачной платформе с автоматическим резервным копированием
+ Android-приложение распространяется как APK-файл
+ Исходный код должен храниться в системе контроля версий (Git)
+ Программная документация хранится совместно с исходным кодом в директории /docs
+ Резервные копии базы данных должны храниться не менее 30 дней
+ Программная документация может быть предоставлена в электронном виде в архиве формата .zip

== Специальные требования

+ *Локализация:* интерфейс программы должен быть на русском языке. Должна быть предусмотрена возможность добавления дополнительных языков в будущих версиях.

+ *Доступность (Accessibility):* программа должна соответствовать базовым требованиям доступности:
  - Достаточный контраст текста (минимум 4.5:1)
  - Возможность увеличения размера шрифта в ридере
  - Поддержка клавиатурной навигации в веб-версии

+ *Офлайн-режим:* Android-приложение должно обеспечивать полноценную работу с предварительно загруженными книгами без подключения к интернету, включая чтение и создание аннотаций.

+ *Масштабируемость:* архитектура системы должна обеспечивать возможность масштабирования для обслуживания растущего числа пользователей без значительной переработки кодовой базы.

+ *Интеграция с российскими ресурсами:* в отличие от зарубежных аналогов, программа должна обеспечивать интеграцию с российскими книжными ресурсами (LitRes) для доступа к русскоязычному контенту.

+ *Конфиденциальность аннотаций:* три уровня доступа к аннотациям (приватный, публичный, по ссылке) являются ключевой особенностью программы и должны быть реализованы в первой версии.

